## Типы индексов и их создание
## B-tree индексы

**B-tree** является наиболее распространенным типом индекса в современных СУБД. Он эффективен для операций сравнения, включая равенство, диапазоны и сортировку:
```sql
CREATE INDEX idx_customer ON customers(last_name);
```
B-tree индексы поддерживают операторы `<`, `<=`, `=`, `>=`, `>`, `BETWEEN`, `IN`, `LIKE` (с префиксом) и `IS NULL`/`IS NOT NULL`.

## Hash индексы
Hash индексы оптимизированы исключительно для операций точного равенства:
```sql
CREATE INDEX idx_customers USING HASH ON customers(last_name);
```
Hash индексы обеспечивают O(1) время доступа, но ограничены только операциями равенства и не поддерживают сортировку.

## Составные индексы
Составные индексы включают несколько колонок и требуют особого внимания к порядку колонок:
```sql
-- Оптимальный составной индекс
CREATE INDEX idx_orders_composite ON orders (customer_id, order_date, status);
```

**Принципы проектирования составных индексов:**
1. **Равенство первыми**: Колонки с условиями равенства (`=`) должны идти первыми
2. **Селективность**: Наиболее селективные колонки должны быть первыми
3. **Частота использования**: Колонки, используемые в большинстве запросов, размещаются первыми
4. **Ограничение количества**: Обычно не более 3-6 колонок для оптимальной производительности

## Частичные индексы

Частичные индексы содержат только строки, удовлетворяющие определенному условию:

```sql
-- PostgreSQL частичный индекс
CREATE INDEX idx_active_customers ON customers (last_name) 
WHERE status = 'active';

-- Индекс для недавних заказов
CREATE INDEX idx_recent_orders ON orders (customer_id, order_date) 
WHERE order_date > CURRENT_DATE - INTERVAL '1 year';
```
**Преимущества частичных индексов:**
- Меньший размер индекса
- Более быстрые операции UPDATE
- Исключение часто встречающихся значений

## Расчет и оценка селективности индексов
## Формула селективности

Селективность индекса рассчитывается по формуле:
```txt
Селективность = Количество уникальных значений / Общее количество строк
```
### Практические примеры расчета
```sql
SELECT 
	COUNT(DISTINCT col) as unique_nums,
	COUNT(*) as total_rows,
	count(distinct col)::float64
```